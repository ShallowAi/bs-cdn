(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{373:function(e,t,s){"use strict";s.r(t);function r(e,t,s,r,a,i,o){try{var n=e[i](o),l=n.value}catch(e){return void s(e)}n.done?t(l):Promise.resolve(l).then(r,a)}function a(e){return function(){var t=this,s=arguments;return new Promise(function(a,i){var o=e.apply(t,s);function n(e){r(o,a,i,n,l,"next",e)}function l(e){r(o,a,i,n,l,"throw",e)}n(void 0)})}}var i={name:"Profile",components:{EmailVerification:s(93).a},data:()=>({oldPassword:"",newPassword:"",confirmPassword:"",nickname:"",email:"",currentPassword:"",deleteConfirm:"",siteName:blessing.site_name,isAdmin:blessing.extra.admin}),methods:{nl2br:e=>e.replace(/\n/g,"<br>"),resetAvatar(){var e=this;return a(function*(){try{yield e.$confirm(e.$t("user.resetAvatarConfirm"))}catch(e){return}const t=(yield e.$http.post("/user/profile/avatar",{tid:0})).msg;e.$message.success(t),Array.from(document.querySelectorAll('[alt="User Image"]')).forEach(e=>e.src+="?".concat((new Date).getTime()))})()},changePassword(){var e=this;return a(function*(){const t=e.oldPassword,s=e.newPassword,r=e.confirmPassword;if(!t)return e.$message.error(e.$t("user.emptyPassword")),void e.$refs.oldPassword.focus();if(!s)return e.$message.error(e.$t("user.emptyNewPassword")),void e.$refs.newPassword.focus();if(!r)return e.$message.error(e.$t("auth.emptyConfirmPwd")),void e.$refs.confirmPassword.focus();if(s!==r)return e.$message.error(e.$t("auth.invalidConfirmPwd")),void e.$refs.confirmPassword.focus();const a=yield e.$http.post("/user/profile?action=password",{current_password:t,new_password:s}),i=a.errno,o=a.msg;return 0===i?(yield e.$alert(o),window.location="".concat(blessing.base_url,"/auth/login")):e.$alert(o,{type:"warning"})})()},changeNickName(){var e=this;return a(function*(){const t=e.nickname;if(!t)return e.$alert(e.$t("user.emptyNewNickName"),{type:"error"});try{yield e.$confirm(e.$t("user.changeNickName",{new_nickname:t}))}catch(e){return}const s=yield e.$http.post("/user/profile?action=nickname",{new_nickname:t}),r=s.errno,a=s.msg;return 0===r?(Array.from(document.querySelectorAll(".nickname")).forEach(e=>e.textContent=t),e.$message.success(a)):e.$alert(a,{type:"warning"})})()},changeEmail(){var e=this;return a(function*(){const t=e.email;if(!t)return e.$alert(e.$t("user.emptyNewEmail"),{type:"error"});if(!/\S+@\S+\.\S+/.test(t))return e.$alert(e.$t("auth.invalidEmail"),{type:"warning"});try{yield e.$confirm(e.$t("user.changeEmail",{new_email:t}))}catch(e){return}const s=yield e.$http.post("/user/profile?action=email",{new_email:t,password:e.currentPassword}),r=s.errno,a=s.msg;return 0===r?(yield e.$message.success(a),window.location="".concat(blessing.base_url,"/auth/login")):e.$alert(a,{type:"warning"})})()},deleteAccount(){var e=this;return a(function*(){const t=e.deleteConfirm;if(!t)return e.$alert(e.$t("user.emptyDeletePassword"),{type:"error"});const s=yield e.$http.post("/user/profile?action=delete",{password:t}),r=s.errno,a=s.msg;if(0!==r)return e.$alert(a,{type:"warning"});yield e.$alert(a,{type:"success"}),window.location="".concat(blessing.base_url,"/auth/login")})()}}},o=s(58),n=Object(o.a)(i,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"content"},[s("email-verification"),e._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-6"},[e._m(0),e._v(" "),s("div",{staticClass:"box box-warning"},[s("div",{staticClass:"box-header with-border"},[s("h3",{directives:[{name:"t",rawName:"v-t",value:"user.profile.password.title",expression:"'user.profile.password.title'"}],staticClass:"box-title"})]),e._v(" "),s("div",{staticClass:"box-body"},[s("div",{staticClass:"form-group"},[s("label",{directives:[{name:"t",rawName:"v-t",value:"user.profile.password.old",expression:"'user.profile.password.old'"}]}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.oldPassword,expression:"oldPassword"}],ref:"oldPassword",staticClass:"form-control",attrs:{type:"password"},domProps:{value:e.oldPassword},on:{input:function(t){t.target.composing||(e.oldPassword=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{directives:[{name:"t",rawName:"v-t",value:"user.profile.password.new",expression:"'user.profile.password.new'"}]}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.newPassword,expression:"newPassword"}],ref:"newPassword",staticClass:"form-control",attrs:{type:"password"},domProps:{value:e.newPassword},on:{input:function(t){t.target.composing||(e.newPassword=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{directives:[{name:"t",rawName:"v-t",value:"user.profile.password.confirm",expression:"'user.profile.password.confirm'"}]}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmPassword,expression:"confirmPassword"}],ref:"confirmPassword",staticClass:"form-control",attrs:{type:"password"},domProps:{value:e.confirmPassword},on:{input:function(t){t.target.composing||(e.confirmPassword=t.target.value)}}})])]),e._v(" "),s("div",{staticClass:"box-footer"},[s("el-button",{attrs:{type:"primary","data-test":"changePassword"},on:{click:e.changePassword}},[e._v("\n            "+e._s(e.$t("user.profile.password.button"))+"\n          ")])],1)])]),e._v(" "),s("div",{staticClass:"col-md-6"},[s("div",{staticClass:"box box-primary"},[s("div",{staticClass:"box-header with-border"},[s("h3",{directives:[{name:"t",rawName:"v-t",value:"user.profile.nickname.title",expression:"'user.profile.nickname.title'"}],staticClass:"box-title"})]),e._v(" "),s("div",{staticClass:"box-body"},[s("div",{staticClass:"form-group has-feedback"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.nickname,expression:"nickname"}],ref:"nickname",staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("user.profile.nickname.rule")},domProps:{value:e.nickname},on:{input:function(t){t.target.composing||(e.nickname=t.target.value)}}}),e._v(" "),s("span",{staticClass:"glyphicon glyphicon-user form-control-feedback"})])]),e._v(" "),s("div",{staticClass:"box-footer"},[s("el-button",{attrs:{type:"primary","data-test":"changeNickName"},on:{click:e.changeNickName}},[e._v("\n            "+e._s(e.$t("general.submit"))+"\n          ")])],1)]),e._v(" "),s("div",{staticClass:"box box-warning"},[s("div",{staticClass:"box-header with-border"},[s("h3",{directives:[{name:"t",rawName:"v-t",value:"user.profile.email.title",expression:"'user.profile.email.title'"}],staticClass:"box-title"})]),e._v(" "),s("div",{staticClass:"box-body"},[s("div",{staticClass:"form-group has-feedback"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],ref:"email",staticClass:"form-control",attrs:{type:"email",placeholder:e.$t("user.profile.email.new")},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),e._v(" "),s("span",{staticClass:"glyphicon glyphicon-envelope form-control-feedback"})]),e._v(" "),s("div",{staticClass:"form-group has-feedback"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.currentPassword,expression:"currentPassword"}],ref:"currentPassword",staticClass:"form-control",attrs:{type:"password",placeholder:e.$t("user.profile.email.password")},domProps:{value:e.currentPassword},on:{input:function(t){t.target.composing||(e.currentPassword=t.target.value)}}}),e._v(" "),s("span",{staticClass:"glyphicon glyphicon-lock form-control-feedback"})])]),e._v(" "),s("div",{staticClass:"box-footer"},[s("el-button",{attrs:{type:"primary","data-test":"changeEmail"},on:{click:e.changeEmail}},[e._v("\n            "+e._s(e.$t("user.profile.email.button"))+"\n          ")])],1)]),e._v(" "),s("div",{staticClass:"box box-danger"},[s("div",{staticClass:"box-header with-border"},[s("h3",{directives:[{name:"t",rawName:"v-t",value:"user.profile.delete.title",expression:"'user.profile.delete.title'"}],staticClass:"box-title"})]),e._v(" "),s("div",{staticClass:"box-body"},[e.isAdmin?[s("p",{directives:[{name:"t",rawName:"v-t",value:"user.profile.delete.admin",expression:"'user.profile.delete.admin'"}]}),e._v(" "),s("el-button",{attrs:{type:"danger",disabled:""}},[e._v("\n              "+e._s(e.$t("user.profile.delete.button"))+"\n            ")])]:[s("p",{directives:[{name:"t",rawName:"v-t",value:{path:"user.profile.delete.notice",args:{site:e.siteName}},expression:"{ path: 'user.profile.delete.notice', args: { site: siteName } }"}]}),e._v(" "),s("el-button",{attrs:{type:"danger","data-toggle":"modal","data-target":"#modal-delete-account"}},[e._v("\n              "+e._s(e.$t("user.profile.delete.button"))+"\n            ")])]],2)])])]),e._v(" "),s("div",{staticClass:"modal modal-danger fade",attrs:{id:"modal-delete-account",tabindex:"-1",role:"dialog"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[e._m(1),e._v(" "),s("h4",{directives:[{name:"t",rawName:"v-t",value:"user.profile.delete.modal-title",expression:"'user.profile.delete.modal-title'"}],staticClass:"modal-title"})]),e._v(" "),s("div",{staticClass:"modal-body"},[e._m(2),e._v(" "),s("br"),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.deleteConfirm,expression:"deleteConfirm"}],staticClass:"form-control",attrs:{type:"password",placeholder:e.$t("user.profile.delete.password")},domProps:{value:e.deleteConfirm},on:{input:function(t){t.target.composing||(e.deleteConfirm=t.target.value)}}}),e._v(" "),s("br")]),e._v(" "),s("div",{staticClass:"modal-footer"},[s("button",{directives:[{name:"t",rawName:"v-t",value:"general.close",expression:"'general.close'"}],staticClass:"btn btn-outline",attrs:{type:"button","data-dismiss":"modal"}}),e._v(" "),s("a",{directives:[{name:"t",rawName:"v-t",value:"general.submit",expression:"'general.submit'"}],staticClass:"btn btn-outline",attrs:{"data-test":"deleteAccount"},on:{click:e.deleteAccount}})])])])])],1)},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"box box-primary"},[s("div",{staticClass:"box-header with-border"},[s("h3",{directives:[{name:"t",rawName:"v-t",value:"user.profile.avatar.title",expression:"'user.profile.avatar.title'"}],staticClass:"box-title"})]),e._v(" "),s("div",{staticClass:"box-body",domProps:{innerHTML:e._s(e.$t("user.profile.avatar.notice"))}}),e._v(" "),s("div",{staticClass:"box-footer"},[s("el-button",{attrs:{type:"primary","data-test":"resetAvatar"},on:{click:e.resetAvatar}},[e._v("\n            "+e._s(e.$t("user.resetAvatar"))+"\n          ")])],1)])},function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[this._v("Ã—")])])},function(){var e=this.$createElement;return(this._self._c||e)("div",{domProps:{innerHTML:this._s(this.nl2br(this.$t("user.profile.delete.modal-notice")))}})}],!1,null,null,null);t.default=n.exports},58:function(e,t,s){"use strict";function r(e,t,s,r,a,i,o,n){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),r&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=l):a&&(l=n?function(){a.call(this,this.$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:c}}s.d(t,"a",function(){return r})},93:function(e,t,s){"use strict";function r(e,t,s,r,a,i,o){try{var n=e[i](o),l=n.value}catch(e){return void s(e)}n.done?t(l):Promise.resolve(l).then(r,a)}var a={name:"EmailVerification",data:()=>({verified:!blessing.extra.unverified,pending:!1}),methods:{resend(){var e,t=this;return(e=function*(){t.pending=!0;const e=yield t.$http.post("/user/email-verification"),s=e.errno,r=e.msg;0===s?t.$message.success(r):t.$message.error(r),t.pending=!1},function(){var t=this,s=arguments;return new Promise(function(a,i){var o=e.apply(t,s);function n(e){r(o,a,i,n,l,"next",e)}function l(e){r(o,a,i,n,l,"throw",e)}n(void 0)})})()}}},i=s(58),o=Object(i.a)(a,function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.verified?e._e():s("div",{staticClass:"callout callout-info"},[s("h4",[s("i",{staticClass:"fas fa-envelope"}),e._v(" "+e._s(e.$t("user.verification.title")))]),e._v(" "),s("p",[e._v("\n    "+e._s(e.$t("user.verification.message"))+"\n    "),e.pending?s("span",[s("i",{staticClass:"fas fa-spin fa-spinner"}),e._v("\n      "+e._s(e.$t("user.verification.sending"))+"\n    ")]):s("a",{attrs:{href:"#"},on:{click:e.resend}},[e._v("\n      "+e._s(e.$t("user.verification.resend"))+"\n    ")])])])},[],!1,null,null,null);t.a=o.exports}}]);