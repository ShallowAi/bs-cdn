(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{375:function(e,t,a){"use strict";a.r(t);var r=a(83),n=(a(78),a(69)),s=a(91);function i(e,t,a,r,n,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(r,n)}function o(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var s=e.apply(t,a);function o(e){i(s,r,n,o,l,"next",e)}function l(e){i(s,r,n,o,l,"throw",e)}o(void 0)})}}var l={name:"PlayersManagement",components:{VueGoodTable:r.a},mixins:[n.a,s.a],props:{baseUrl:{type:String,default:blessing.base_url}},data(){return{players:[],columns:[{field:"pid",label:"PID",type:"number"},{field:"name",label:this.$t("general.player.player-name")},{field:"uid",label:this.$t("general.player.owner"),type:"number"},{field:"preview",label:this.$t("general.player.previews"),globalSearchDisabled:!0,sortable:!1},{field:"last_modified",label:this.$t("general.player.last-modified")},{field:"operations",label:this.$t("admin.operationsTitle"),globalSearchDisabled:!0,sortable:!1}],textureChanges:{originalIndex:-1,type:"skin",tid:""}}},beforeMount(){this.fetchData()},methods:{fetchData(){var e=this;return o(function*(){const t=yield e.$http.get("/admin/player-data".concat(location.search),!location.search&&e.serverParams),a=t.data,r=t.totalRecords;e.totalRecords=r,e.players=a})()},changeTexture(){var e=this;return o(function*(){const t=e.players[e.textureChanges.originalIndex],a=e.textureChanges,r=a.type,n=a.tid,s=yield e.$http.post("/admin/players?action=texture",{pid:t.pid,type:r,tid:n}),i=s.errno,o=s.msg;0===i?(t["tid_".concat(r)]=n,e.$message.success(o),$(".modal").modal("hide")):e.$message.warning(o)})()},changeName(e){var t=this;return o(function*(){let a;try{a=(yield t.$prompt(t.$t("admin.changePlayerNameNotice"),{inputValue:e.name,inputValidator:e=>!!e||t.$t("admin.emptyPlayerName")})).value}catch(e){return}const r=yield t.$http.post("/admin/players?action=name",{pid:e.pid,name:a}),n=r.errno,s=r.msg;0===n?(e.name=a,t.$message.success(s)):t.$message.warning(s)})()},changeOwner(e){var t=this;return o(function*(){let a;try{a=(yield t.$prompt(t.$t("admin.changePlayerOwner"),{inputValue:e.uid})).value}catch(e){return}const r=yield t.$http.post("/admin/players?action=owner",{pid:e.pid,uid:a}),n=r.errno,s=r.msg;0===n?(e.uid=a,t.$message.success(s)):t.$message.warning(s)})()},deletePlayer(e){var t=this;return o(function*(){let a=e.pid,r=e.originalIndex;try{yield t.$confirm(t.$t("admin.deletePlayerNotice"),{type:"warning"})}catch(e){return}const n=yield t.$http.post("/admin/players?action=delete",{pid:a}),s=n.errno,i=n.msg;0===s?(t.$delete(t.players,r),t.$message.success(i)):t.$message.warning(i)})()}}},d=a(58),c=Object(d.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"content"},[a("vue-good-table",{attrs:{mode:"remote",rows:e.players,"total-rows":e.totalRecords||e.players.length,columns:e.columns,"search-options":e.tableOptions.search,"pagination-options":e.tableOptions.pagination,"style-class":"vgt-table striped"},on:{"on-page-change":e.onPageChange,"on-sort-change":e.onSortChange,"on-search":e.onSearch,"on-per-page-change":e.onPerPageChange},scopedSlots:e._u([{key:"table-row",fn:function(t){return["name"===t.column.field?a("span",[e._v("\n        "+e._s(t.formattedRow[t.column.field])+"\n        "),a("a",{attrs:{title:e.$t("admin.changePlayerName"),"data-test":"name"},on:{click:function(a){return e.changeName(t.row)}}},[a("i",{staticClass:"fas fa-edit btn-edit"})])]):"uid"===t.column.field?a("span",[a("a",{attrs:{href:e.baseUrl+"/admin/users?uid="+t.row.uid,title:e.$t("admin.inspectHisOwner"),"data-toggle":"tooltip","data-placement":"right"}},[e._v(e._s(t.formattedRow[t.column.field]))]),e._v(" "),a("a",{attrs:{title:e.$t("admin.changeOwner"),"data-test":"owner"},on:{click:function(a){return e.changeOwner(t.row)}}},[a("i",{staticClass:"fas fa-edit btn-edit"})])]):"preview"===t.column.field?a("span",[t.row.tid_skin?a("a",{attrs:{href:e.baseUrl+"/skinlib/show/"+t.row.tid_skin}},[a("img",{attrs:{src:e.baseUrl+"/preview/64/"+t.row.tid_skin+".png",width:"64"}})]):e._e(),e._v(" "),t.row.tid_cape?a("a",{attrs:{href:e.baseUrl+"/skinlib/show/"+t.row.tid_cape}},[a("img",{attrs:{src:e.baseUrl+"/preview/64/"+t.row.tid_cape+".png",width:"64"}})]):e._e()]):"operations"===t.column.field?a("span",[a("el-button",{attrs:{"data-toggle":"modal","data-target":"#modal-change-texture",size:"medium"},on:{click:function(a){e.textureChanges.originalIndex=t.row.originalIndex}}},[e._v(e._s(e.$t("admin.changeTexture")))]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"medium"},on:{click:function(a){return e.deletePlayer(t.row)}}},[e._v(e._s(e.$t("admin.deletePlayer")))])],1):a("span",{domProps:{textContent:e._s(t.formattedRow[t.column.field])}})]}}])}),e._v(" "),a("div",{staticClass:"modal fade",attrs:{id:"modal-change-texture",tabindex:"-1",role:"dialog"}},[a("div",{staticClass:"modal-dialog"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[e._m(0),e._v(" "),a("h4",{directives:[{name:"t",rawName:"v-t",value:"admin.changeTexture",expression:"'admin.changeTexture'"}],staticClass:"modal-title"})]),e._v(" "),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{directives:[{name:"t",rawName:"v-t",value:"admin.textureType",expression:"'admin.textureType'"}]}),e._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:e.textureChanges.type,expression:"textureChanges.type"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(e.textureChanges,"type",t.target.multiple?a:a[0])}}},[a("option",{directives:[{name:"t",rawName:"v-t",value:"general.skin",expression:"'general.skin'"}],attrs:{value:"skin"}}),e._v(" "),a("option",{directives:[{name:"t",rawName:"v-t",value:"general.cape",expression:"'general.cape'"}],attrs:{value:"cape"}})])]),e._v(" "),a("div",{staticClass:"form-group"},[a("label",[e._v("TID")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.textureChanges.tid,expression:"textureChanges.tid",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("admin.pidNotice")},domProps:{value:e.textureChanges.tid},on:{input:function(t){t.target.composing||e.$set(e.textureChanges,"tid",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),e._v(" "),a("div",{staticClass:"modal-footer"},[a("el-button",{attrs:{"data-dismiss":"modal"}},[e._v(e._s(e.$t("general.close")))]),e._v(" "),a("el-button",{attrs:{type:"primary","data-test":"changeTexture"},on:{click:e.changeTexture}},[e._v("\n            "+e._s(e.$t("general.submit"))+"\n          ")])],1)])])])],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{attrs:{"aria-hidden":"true"}},[this._v("Ã—")])])}],!1,null,null,null);t.default=c.exports},69:function(e,t,a){"use strict";var r=a(0);t.a=r.default.extend({data(){return{tableOptions:{search:{enabled:!0,placeholder:this.$t("vendor.datatable.search")},pagination:{enabled:!0,nextLabel:this.$t("vendor.datatable.next"),prevLabel:this.$t("vendor.datatable.prev"),rowsPerPageLabel:this.$t("vendor.datatable.rowsPerPage"),allLabel:this.$t("vendor.datatable.all"),ofLabel:this.$t("vendor.datatable.of")}}}}})},91:function(e,t,a){"use strict";var r=a(0);function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw s}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.a=r.default.extend({data:()=>({columns:[{field:"id"}],totalRecords:0,serverParams:{sortField:"id",sortType:"asc",page:1,perPage:10,search:""}}),created(){this.serverParams.sortField=this.columns[0].field},methods:{fetchData:()=>Promise.resolve(),onPageChange(e){this.serverParams.page=e.currentPage,this.fetchData()},onPerPageChange(e){this.serverParams.perPage=e.currentPerPage,this.fetchData()},onSortChange(e){let t=n(e,1)[0];this.serverParams.sortType=t.type,this.serverParams.sortField=t.field,this.fetchData()},onSearch(e){this.serverParams.search=e.searchTerm,this.fetchData()}}})}}]);